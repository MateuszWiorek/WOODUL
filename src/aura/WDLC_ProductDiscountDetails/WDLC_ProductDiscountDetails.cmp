<!--
 - Created by Mateusz Wiorek on 03.04.2020.
 -->

<aura:component description="WDLC_ProductDiscountDetails"
                controller="WDLC_DiscountManagerController" implements="flexiPage:availableForAllPageTypes">
    <aura:attribute name="pricebookId" type="Object" access="global"/>
    <aura:attribute name="pricebook" type="Object" access="global"/>
    <aura:attribute name="discountedItems" type="Object[]" access="global"/>
    <aura:attribute name="page" type="Integer" access="global" default="1"/>
    <aura:attribute name="name" type="String" access="global"/>
    <aura:attribute name="canBeShown" type="Boolean" access="global" default="false"/>
    <aura:attribute name="isDiscountSelected" type="Boolean" access="global" default="false"/>
    <aura:attribute name="newStartDate" type="Date" access="global" default="{!v.pricebook.StartDate__c}"/>
    <aura:attribute name="newEndDate" type="Date" access="global" default="{!v.pricebook.EndDate__c}"/>
    <aura:attribute name="canBeEdited" type="Boolean" access="global" default="true"/>

    <aura:handler event="c:WDLC_SendPricebookDetails" action="{!c.showDetails}"/>

    <aura:if isTrue="{!not(empty(v.pricebookId))}">
        <lightning:card>
            <div class="borderRadiusClass" style="padding-top:10px;">
            <lightning:recordViewForm objectApiName="Pricebook2" recordId="{!v.pricebookId}">
                <div class="slds-grid slds-wrap">
                    <div class="slds-col slds-size--2-of-12" style="padding-left: 10px;">
                        <label class="slds-form-element__label" for="text-input-id-1" id="inline-text-label">Discount
                            Name</label>
                        <br/>
                        <ui:outputText value="{!v.pricebook.Name}"/>
                    </div>
                    <div class="slds-col slds-size--3-of-12">
                        <lightning:input type="date" label="Start Date"
                                         placeholder="{!v.pricebook.StartDate__c}"
                                         value="{!v.newStartDate}" displayDatePicker="true" disabled="{!not(v.canBeEdited)}"/>
                    </div>
                    <div class="slds-col slds-size--1-of-12"/>
                    <div class="slds-col slds-size--3-of-12">
                        <lightning:input type="date" label="End Date"
                                         placeholder="{!v.pricebook.StartDate__c}"
                                         value="{!v.newEndDate}" displayDatePicker="true" disabled="{!not(v.canBeEdited)}"/>
                    </div>
                    <div class="slds-col slds-size--1-of-12"/>
                    <div class="slds-col slds-size--2-of-12">
                        <lightning:button onclick="{!c.editDiscount}" class="buttonSLDS slds-float_right">Edit discount</lightning:button>
                    </div>
                </div>
            </lightning:recordViewForm>
            <lightning:tabset>
                <lightning:tab label="{!$Label.c.WDLC_DiscountProducts}">
                        <c:WDLC_DiscountSearchResults results="{!v.discountedItems}" discount="{!v.name}"/>
                </lightning:tab>
                <lightning:tab label="{!$Label.c.WDLC_AddToDiscount}">
                    <div style="margin-bottom: 15px;">
                        <c:WDLC_ProductDiscountSearchProduct/>
                    </div>
                    <aura:if isTrue="{!v.isDiscountSelected}">
                        <c:WDLC_ProductDiscountSearchResultsList discount="{!v.name}"/>
                    </aura:if>
                </lightning:tab>
            </lightning:tabset>
            </div>
        </lightning:card>
    </aura:if>
    <c:WDL_ModalComponent type="newDiscount" canBeShown="{!v.canBeShown}"/>
    <c:WDL_ShowErrorComponent aura:id="informationToast"/>
    <c:WDLC_ErrorToast aura:id="errorToast"/>
</aura:component>